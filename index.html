<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">


























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=6.7.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.7.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.7.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.7.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.7.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '6.7.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="keywords" content="Natural-Language-Processing Open-Source Reading">
<meta property="og:type" content="website">
<meta property="og:title" content="Zhaoqing Xu&#39;s Blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Zhaoqing Xu&#39;s Blog">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Zhaoqing Xu&#39;s Blog">






  <link rel="canonical" href="http://yoursite.com/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Zhaoqing Xu's Blog</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Zhaoqing Xu's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home menu-item-active">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>About</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>Categories</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-sitemap">

    
    
    
      
    

    

    <a href="/sitemap.xml" rel="section"><i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br>Sitemap</a>

  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/17/*运算符在python中的解压、传参用法/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhaoqing Xu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhaoqing Xu's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/01/17/*运算符在python中的解压、传参用法/" class="post-title-link" itemprop="url">Untitled</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-01-17 02:11:02 / Modified: 02:10:28" itemprop="dateCreated datePublished" datetime="2019-01-17T02:11:02-05:00">2019-01-17</time>
            

            
              

              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="运算符在python中的解压、传参用法"><a href="#运算符在python中的解压、传参用法" class="headerlink" title="* 运算符在python中的解压、传参用法"></a>* 运算符在python中的解压、传参用法</h1><p>这两天得了一本《Python Cookbook》，甚是喜爱，希望能记录一点有意思的Python 用法，既是作为自己的读书笔记，让自己能够不断精进技术，也是为了能够和大家一起讨论Python。</p>
<h2 id="从zip说开去"><a href="#从zip说开去" class="headerlink" title="从zip说开去"></a>从zip说开去</h2><p>*操作符在Python中除了乘法和复制(如[1] * 5)的用法之外，还有解压(unpack)的功能，这应该是所有用过zip()的人都知道的事情。zip函数的基本用法如下:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">stuff = [<span class="string">'apple'</span>,<span class="string">'banana'</span>,<span class="string">'peach'</span>]</span><br><span class="line">money = [<span class="number">10</span>, <span class="number">5</span>, <span class="number">7</span>]</span><br><span class="line"></span><br><span class="line">pair = list(zip(stuff,money))</span><br><span class="line"><span class="comment"># pair = [('apple',10),('banana',5),('peach',7)]</span></span><br></pre></td></tr></table></figure>
<p>但是如果我们现在已经有 pair 这个 list 了，希望能够还原成stuff 和 money 两个 list,我们就需要用到*符号:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stuff,money = zip(*pair)</span><br></pre></td></tr></table></figure></p>
<p>在这里*就起到了解压的效果</p>
<h2 id="对于迭代对象的作用"><a href="#对于迭代对象的作用" class="headerlink" title="*对于迭代对象的作用"></a>*对于迭代对象的作用</h2><p>当然了，*并不是说只能与 zip() 联合使用，事实上，任何一个函数都可以用到*符号，只要它操作的对象是可迭代的:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">do_something</span><span class="params">(x,y,z)</span>:</span></span><br><span class="line">    print(<span class="string">'x is '</span>, x)</span><br><span class="line">    print(<span class="string">'y is '</span>, y)</span><br><span class="line">    print(<span class="string">'z is '</span>, z)</span><br><span class="line">    </span><br><span class="line">list1 = [<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>do_something(list1)</span><br><span class="line">Trackback (most recent call last):</span><br><span class="line">   File <span class="string">"&lt;stdin&gt;"</span>, line1, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">TypeError: do() missing <span class="number">2</span> required positional arguments: <span class="string">'y'</span> <span class="keyword">and</span> <span class="string">'z'</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>do_something(*list1)</span><br><span class="line">x <span class="keyword">is</span> a</span><br><span class="line">y <span class="keyword">is</span> b</span><br><span class="line">z <span class="keyword">is</span> c</span><br></pre></td></tr></table></figure></p>
<p>可知，<code>*</code>操作符自动将 list1 中的元素赋给了三个形参，这就是<code>*</code>很方便的用法</p>
<h2 id="的用法"><a href="#的用法" class="headerlink" title="**的用法"></a>**的用法</h2><p>当然，对于字典(dict)来说，我们也可以使用<code>*</code>运算符:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">dict1 = &#123;<span class="string">'x'</span>:<span class="number">1</span>, <span class="string">'y'</span>:<span class="number">2</span>, <span class="string">'z'</span>:<span class="number">3</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>do_something(*dict1)</span><br><span class="line">x <span class="keyword">is</span> x</span><br><span class="line">y <span class="keyword">is</span> y</span><br><span class="line">z <span class="keyword">is</span> z</span><br></pre></td></tr></table></figure></p>
<p>但是这样子得到的是 key 值，如果想要得到 value 值，我们需要使用<code>**</code>运算符:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>do_somthing(**dict1)</span><br><span class="line">x <span class="keyword">is</span> <span class="number">1</span></span><br><span class="line">y <span class="keyword">is</span> <span class="number">2</span></span><br><span class="line">z <span class="keyword">is</span> <span class="number">3</span></span><br></pre></td></tr></table></figure></p>
<p><strong>一定要注意的是，此处的用法必须要求函数形参与字典 key 值一一对应</strong>，请看下面的用法:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">dict2 = &#123;<span class="string">'z'</span>:<span class="number">1</span>, <span class="string">'x'</span>:<span class="number">2</span>, <span class="string">'y'</span>:<span class="number">3</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>do_something(**dict2)</span><br><span class="line">x <span class="keyword">is</span> <span class="number">2</span></span><br><span class="line">y <span class="keyword">is</span> <span class="number">3</span></span><br><span class="line">z <span class="keyword">is</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line">dict3 = &#123;<span class="string">'a'</span>:<span class="number">1</span>, <span class="string">'b'</span>:<span class="number">2</span>, <span class="string">'c'</span>:<span class="number">3</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>do_something(**dict3)</span><br><span class="line"><span class="comment"># TypeError: do_something() missing 1 required positional argument: 'x'</span></span><br></pre></td></tr></table></figure></p>
<p>实际上，<code>**</code>的用法应该这么理解:</p>
<pre><code>**dict2 等效于 z=1, x=2, y=3， 因此 do_something(**dict2) 等效于 do_something(z=1, x=2, y=3), 这样看来，dict3的错误就是必然的了，因为函数没有 a 这个参数
</code></pre><p>为了加深理解，请看下面这条例子(来自Reference 2):<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>date_info = &#123;<span class="string">'year'</span>: <span class="string">"2020"</span>, <span class="string">'month'</span>: <span class="string">"01"</span>, <span class="string">'day'</span>: <span class="string">"01"</span>&#125; </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>filename = <span class="string">"&#123;year&#125;-&#123;month&#125;-&#123;day&#125;.txt"</span>.format(**date_info) </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>filename</span><br><span class="line"><span class="string">'2020-01-01.txt'</span></span><br></pre></td></tr></table></figure></p>
<h2 id="理解-args-和-kwargs"><a href="#理解-args-和-kwargs" class="headerlink" title="理解 *args 和**kwargs"></a>理解 <code>*args</code> 和<code>**kwargs</code></h2><p><code>*args</code>和<code>**kwargs</code>是我们经常见到的两个参数，但这两个参数究竟是干什么的可能有些人仍有疑惑。其实它们的用法也很简单，对于一个函数而言，如果你不确定它还有什么待传入的参数，就不妨用一个<code>*args</code>(当然你不一定非得叫<code>args</code>，但一般都喜欢起这个名字)，它将输入的多余形参以元组形式保存在<code>args</code>中:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#两个数的加法</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">adder_2</span><span class="params">(x,y)</span>:</span></span><br><span class="line">  <span class="keyword">return</span> x+y</span><br><span class="line"></span><br><span class="line"><span class="comment">#三个数的加法</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">adder_3</span><span class="params">(x,y,z)</span>:</span></span><br><span class="line">  <span class="keyword">return</span> x+y+z</span><br><span class="line"></span><br><span class="line"><span class="comment"># 无限个数的加法</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">adder_unlimited</span><span class="params">(*args)</span>:</span></span><br><span class="line">   result = <span class="number">0</span></span><br><span class="line">   <span class="keyword">for</span> num <span class="keyword">in</span> args:</span><br><span class="line">       result += num</span><br><span class="line">   <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>adder_unlimited(<span class="number">1</span>)</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>adder_unlimited(<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>adder_unlimited(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>)</span><br><span class="line"><span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list_num = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>adder_unlimited(*list_num)  <span class="comment">#活学活用</span></span><br><span class="line"><span class="number">10</span></span><br></pre></td></tr></table></figure></p>
<p><code>**kwargs</code>效果则是将输入的未定义的形参及其对应的值存在<code>kwargs</code>字典里(例子来源Reference 4):<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">intro</span><span class="params">(**data)</span>:</span></span><br><span class="line">    print(<span class="string">"\nData type of argument:"</span>,type(data))</span><br><span class="line">    <span class="keyword">for</span> key, value <span class="keyword">in</span> data.items():</span><br><span class="line">        print(<span class="string">"&#123;&#125; is &#123;&#125;"</span>.format(key,value))</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>intro(Firstname=<span class="string">"Sita"</span>, Lastname=<span class="string">"Sharma"</span>, Age=<span class="number">22</span>, Phone=<span class="number">1234567890</span>)</span><br><span class="line"></span><br><span class="line">Data type of argument: &lt;<span class="class"><span class="keyword">class</span> '<span class="title">dict</span>'&gt;</span></span><br><span class="line"><span class="class"><span class="title">Firstname</span> <span class="title">is</span> <span class="title">Sita</span></span></span><br><span class="line"><span class="class"><span class="title">Lastname</span> <span class="title">is</span> <span class="title">Sharma</span></span></span><br><span class="line"><span class="class"><span class="title">Age</span> <span class="title">is</span> 22</span></span><br><span class="line"><span class="class"><span class="title">Phone</span> <span class="title">is</span> 1234567890</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">intro</span><span class="params">(Firstname=<span class="string">"John"</span>, Lastname=<span class="string">"Wood"</span>, Email=<span class="string">"johnwood@nomail.com"</span>, Country=<span class="string">"Wakanda"</span>, Age=<span class="number">25</span>, Phone=<span class="number">9876543210</span>)</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">Data</span> <span class="title">type</span> <span class="title">of</span> <span class="title">argument</span>:</span> &lt;<span class="class"><span class="keyword">class</span> '<span class="title">dict</span>'&gt;</span></span><br><span class="line"><span class="class"><span class="title">Firstname</span> <span class="title">is</span> <span class="title">John</span></span></span><br><span class="line"><span class="class"><span class="title">Lastname</span> <span class="title">is</span> <span class="title">Wood</span></span></span><br><span class="line"><span class="class"><span class="title">Email</span> <span class="title">is</span> <span class="title">johnwood</span>@<span class="title">nomail</span>.<span class="title">com</span></span></span><br><span class="line"><span class="class"><span class="title">Country</span> <span class="title">is</span> <span class="title">Wakanda</span></span></span><br><span class="line"><span class="class"><span class="title">Age</span> <span class="title">is</span> 25</span></span><br><span class="line"><span class="class"><span class="title">Phone</span> <span class="title">is</span> 9876543210</span></span><br></pre></td></tr></table></figure></p>
<p>因此，对于一个好的 API 来说，应该尽量使用<code>*args</code>和<code>**kwargs</code>以提高程序稳定性</p>
<h2 id="利用-从可迭代对象中分解元素"><a href="#利用-从可迭代对象中分解元素" class="headerlink" title="利用*从可迭代对象中分解元素"></a>利用*从可迭代对象中分解元素</h2><p>说了这么多终于说到了《Python Cookbook》中的内容了(内心OS:累死我了)。 假设我们现在要对一个歌手的表现打分，去掉一个最高分，去掉一个最低分，对其他所有分数（未知个数）求平均分，这时<code>*</code>方法就派上用场了:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">drop_first_last</span><span class="params">(grades)</span>:</span></span><br><span class="line">   first, *middle, last = grades</span><br><span class="line">   <span class="keyword">return</span> avg(middle)</span><br></pre></td></tr></table></figure></p>
<p> 也许你会说，用切片也可以达到同样效果，如<code>middle = grades[1:-1]</code>，但如果我们需要用到<code>first</code>和<code>last</code>呢？你是不是还要<code>first = grades[0]</code>和<code>last = grades[-1]</code>呢？ 太不优雅了！ 事实上，下面这个例子如果用切片来写就十分麻烦(来源 Reference 3):</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;line = <span class="string">'nobody:*:-2:-2:Unprevileged User:/var/empty:/usr/bin/false'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>uname,*_, homedir, sh = line.split(<span class="string">':'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>uname</span><br><span class="line"><span class="string">'nobody'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>homedir</span><br><span class="line"><span class="string">'/var/empty'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sh</span><br><span class="line"><span class="string">'/usr/bin/false'</span></span><br></pre></td></tr></table></figure>
<p>其中<code>*_</code>将我们 split 之后不想要的部分直接丢弃了(一般用下划线来为我们不需要的变量取名)</p>
<p>实际上，<code>*</code>操作和函数式语言中的列表处理功能相似，相信学过Coursera 华盛顿大学神课<strong>Programming Language</strong>的同学对这一形式一定不会陌生(来源 Reference3):</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sum</span><span class="params">(items)</span>:</span></span><br><span class="line">   head, *tail = items</span><br><span class="line">   <span class="keyword">return</span> head + sum(tail) <span class="keyword">if</span> tail <span class="keyword">else</span> head</span><br></pre></td></tr></table></figure>
<p>当然，限于Python自身内部对递归的次数限制，这个例子在实践中意义不大，但是它确实是十分精妙，令人不禁击节赞叹！</p>
<h2 id="其他奇技淫巧"><a href="#其他奇技淫巧" class="headerlink" title="其他奇技淫巧"></a>其他奇技淫巧</h2><p>还有一些我不知道怎么分类的小技术，在这里也一并献给大家(例子来自 Reference 2):</p>
<h3 id="列表元素快速换位置"><a href="#列表元素快速换位置" class="headerlink" title="列表元素快速换位置"></a>列表元素快速换位置</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sequence = [*sequence[<span class="number">1</span>:], sequence[<span class="number">0</span>]] <span class="comment">#将首个元素换到最后一个</span></span><br></pre></td></tr></table></figure>
<h3 id="将多个迭代对象转化为-list"><a href="#将多个迭代对象转化为-list" class="headerlink" title="将多个迭代对象转化为 list"></a>将多个迭代对象转化为 list</h3><p>很多时候，我们在使用完一个函数时，他返回的值都是generator 等迭代对象，必须套上一个<code>list()</code>才可以变为列表，如<code>zip()</code>，<code>reversed()</code>等，此时如果每个函数都套上<code>list()</code>则显得不够优雅，更好的方式如下:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">palindromify</span><span class="params">(sequence)</span>:</span> </span><br><span class="line">    <span class="keyword">return</span> list(sequence) + list(reversed(sequence)) <span class="comment">#不够优雅</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">palindromify</span><span class="params">(sequence)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> [*sequence, *reversed(sequence)] <span class="comment"># better</span></span><br></pre></td></tr></table></figure></p>
<p>同理，多个 list 的拼接也可以如法炮制:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">list_all = [*list1,*list2,*list3,*list4]</span><br></pre></td></tr></table></figure></p>
<h3 id="字典的合并"><a href="#字典的合并" class="headerlink" title="字典的合并"></a>字典的合并</h3><p>同理，字典的合并用<code>**</code>也是十分方便:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>date_info = &#123;<span class="string">'year'</span>: <span class="string">"2020"</span>, <span class="string">'month'</span>: <span class="string">"01"</span>, <span class="string">'day'</span>: <span class="string">"01"</span>&#125; </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>track_info = &#123;<span class="string">'artist'</span>: <span class="string">"Beethoven"</span>, <span class="string">'title'</span>: <span class="string">'Symphony No 5'</span>&#125; </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>all_info = &#123;**date_info, **track_info&#125; </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>all_info &#123;<span class="string">'year'</span>: <span class="string">'2020'</span>, <span class="string">'month'</span>: <span class="string">'01'</span>, <span class="string">'day'</span>: <span class="string">'01'</span>, <span class="string">'artist'</span>: <span class="string">'Beethoven'</span>, <span class="string">'title'</span>: <span class="string">'Symphony No 5'</span>&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="最后的闲言碎语"><a href="#最后的闲言碎语" class="headerlink" title="最后的闲言碎语"></a>最后的闲言碎语</h2><p>第一次写技术博客，竟然写了三个小时，大概算是涵盖了大部分<code>*</code>的用法，希望这是一个好的开始，也希望所有读者能多提些宝贵意见，谢谢！ 之后我还想补充一下Python中<code>*</code>是如何实现的，不过这个可能得去翻源码才能有所斩获吧！</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ol>
<li><a href="https://www.programiz.com/python-programming/methods/built-in/zip" target="_blank" rel="noopener">Python Zip()</a></li>
<li><a href="https://treyhunner.com/2018/10/asterisks-in-python-what-they-are-and-how-to-use-them/" target="_blank" rel="noopener">Asterisks in Python: what they are and how to use them</a></li>
<li><a href="https://www.amazon.com/Python-Cookbook-Third-David-Beazley/dp/1449340377" target="_blank" rel="noopener">Python Cookbook</a></li>
<li><a href="https://www.programiz.com/python-programming/args-and-kwargs" target="_blank" rel="noopener">Python *args and **kwargs</a></li>
</ol>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/12/hello-world/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhaoqing Xu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhaoqing Xu's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/01/12/hello-world/" class="post-title-link" itemprop="url">Hello World</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-01-12 09:20:02" itemprop="dateCreated datePublished" datetime="2019-01-12T09:20:02-05:00">2019-01-12</time>
            

            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/14/archivers/GSOC-Final-Submission/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhaoqing Xu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhaoqing Xu's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/08/14/archivers/GSOC-Final-Submission/" class="post-title-link" itemprop="url">GSOC Final Submission</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-08-14 00:00:00" itemprop="dateCreated datePublished" datetime="2018-08-14T00:00:00-04:00">2018-08-14</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-01-17 00:54:32" itemprop="dateModified" datetime="2019-01-17T00:54:32-05:00">2019-01-17</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/GSOC/" itemprop="url" rel="index"><span itemprop="name">GSOC</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>I have finished the GSOC journey during the last 3 months. Thanks for the help from Prof. Francis Steen and Prof. Mark Turner and all the people from Red Hen Lab who helped me overcome so many problems and difficulties. By the end of the program, I build up a Chinese Pipeline which could extract the text from the videos(offered by Red Hen Lab, mostly Chinese news) automatically so that we could do natural language processing tasks afterwards. Technically, I learned HPC, singularity and all the container concepts, how to set up a singularity environment via recipe, how to write shell scripts, how to organize an open source project and some more details about the implementation of DeepSpeech2 from Baidu.</p>
<h2 id="Some-Links-about-my-work"><a href="#Some-Links-about-my-work" class="headerlink" title="Some Links about my work"></a>Some Links about my work</h2><ul>
<li>Github: <a href="https://github.com/RedHenLab/ASR-for-Chinese-Pipeline" target="_blank" rel="noopener">https://github.com/RedHenLab/ASR-for-Chinese-Pipeline</a></li>
<li>Red Hen Lab page: <a href="http://www.redhenlab.org/home/the-cognitive-core-research-topics-in-red-hen/chinese-pipeline" target="_blank" rel="noopener">http://www.redhenlab.org/home/the-cognitive-core-research-topics-in-red-hen/chinese-pipeline</a></li>
<li>My personal website: xuzhaoqing.github.io</li>
</ul>
<h2 id="Introduction-about-Chinese-Pipeline"><a href="#Introduction-about-Chinese-Pipeline" class="headerlink" title="Introduction about Chinese Pipeline"></a>Introduction about Chinese Pipeline</h2><p>My project is to implement a pipeline to extract the text of the voices in the videos(mostly Chinese TV news) from Red Hen Lab. The task is most related to Autimatic Speech Recognition.  </p>
<h2 id="What-I-have-done"><a href="#What-I-have-done" class="headerlink" title="What I have done"></a>What I have done</h2><ul>
<li>I read all of the paper and codes in Baidu Deepspeech2 in detail and use part of their tools and pretrained models to fit our needs. You could go here to see their incredible work: <a href="https://github.com/PaddlePaddle/DeepSpeech#questions-and-help" target="_blank" rel="noopener">Deepspeech2</a></li>
<li>I got used to using singularity and upload the image that we use to singularity hub: <a href="https://www.singularity-hub.org/collections/1174" target="_blank" rel="noopener">image</a> so that everyone, no matter if they were in Red Hen Lab or not, could use this image to do their ASR tasks following our instructions. To know the differences between singularity,docker and shifter, here is a great article: <a href="http://geekyap.blogspot.com/2016/11/docker-vs-singularity-vs-shifter-in-hpc.html" target="_blank" rel="noopener">http://geekyap.blogspot.com/2016/11/docker-vs-singularity-vs-shifter-in-hpc.html</a></li>
<li>I did the preprocessing of our data, including convert videos to audios, spliting them, resampling and so on. You could check <a href="https://xuzhaoqing.github.io/archivers/Prepare-the-Data" target="_blank" rel="noopener">Prepare the data I</a> and <a href="https://xuzhaoqing.github.io/archivers/Prepare-the-Data-2" target="_blank" rel="noopener">Prepare the data II</a> to see the details.</li>
<li>After that, I first experimented the project on a video so that I could write the python code, shell scripts and parameters tuning. It cost me a lot of time and you could see the result in the <code>example/output/1.txt</code>   </li>
<li>After that, I put it into production with all of our data available, a little of change on code could satisfy your requirement for your task. You could see the main implementation in <code>code</code> folder.</li>
<li>Finally, I write all the docs, wikis and comments of the code.</li>
</ul>
<h2 id="To-be-continued"><a href="#To-be-continued" class="headerlink" title="To be continued"></a>To be continued</h2><ul>
<li>Currently the code in real production is not efficient. I have to implement <code>monitor-new-data</code> function for it, and mutli-thread techniques will help me save a lot of time.</li>
<li>Use the data to do some easy nlp tasks like word segmentation, word counts and so on. It would be easily done in 1 or 2 days.</li>
<li>aligments would be a nice task to try.</li>
</ul>
<h2 id="Reproduce-my-work"><a href="#Reproduce-my-work" class="headerlink" title="Reproduce my work"></a>Reproduce my work</h2><h3 id="Get-into-the-server"><a href="#Get-into-the-server" class="headerlink" title="Get into the server"></a>Get into the server</h3><p><code>only for people in Red Hen Lab</code> But if you have a similiar HPC environment, it’s still useful for you to know.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">module load singularity/2.5.1</span><br><span class="line">module load cuda/7.5</span><br><span class="line">export SINGULARITY_BINDPATH=&quot;/mnt&quot;</span><br><span class="line">srun -p gpu -C gpup100 --mem=100gb --gres=gpu:2 --pty bash</span><br><span class="line">cd /mnt/rds/redhen/gallina/Singularity/Chinese_Pipeline</span><br><span class="line">singularity shell -e --nv Chinese_Pipeline.simg</span><br></pre></td></tr></table></figure></p>
<p>or if you don’t want to know the details and just want to check our work, just check <code>/mnt/rds/redhen/gallina/Singularity/Chinese_Pipeline/srun.out</code></p>
<h3 id="The-Example"><a href="#The-Example" class="headerlink" title="The Example"></a>The Example</h3><p>Before we really put it into production, let’s look at an example to see how it works clearly.<br>Firstly, let’s get into the <code>example</code> folder:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd example</span><br></pre></td></tr></table></figure></p>
<p>here we can find a mini structure of our program(or actually the core of our program):<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[zxx302@hpc3 example]$ ls</span><br><span class="line">compute_mean.sh      EX.wav       manifest.py   params.tar.gz</span><br><span class="line">compute_mean_std.py  infer.py     mean_std.npz  split</span><br><span class="line">data_utils           infer.sh     model_utils   utils</span><br><span class="line">decoders             manifest.ex  output        vocab.txt</span><br></pre></td></tr></table></figure></p>
<p>You could find a detailed explanation of these files in:</p>
<p>Here let’s just see the result:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[zxx302@hpc3 example]$ vim output/1.txt</span><br><span class="line">一二一运动与人文文</span><br><span class="line">名人名言</span><br><span class="line">对公众网上和上行今年十一月二十号五十六有小雨今天是二十世纪中的行为受</span><br><span class="line">美国的一年节目的主要有中共中央召开党外人士座谈会征求对中共中央关于修改宪法部分内</span><br><span class="line">容的</span><br><span class="line">一天习近平主持并发表重要讲话张德江俞正声李战书汪洋蒙古民主席写报道在一</span><br><span class="line">新时代通过合作社会主义思想的影响今天来看贫困县最多的云南省是有中国百姓新的透明质</span><br><span class="line">感空间感</span><br><span class="line">确保给群众出摆脱贫困实现共同和分别是创新方法防治大气污染南京市吸纳顶尖人才抢占战</span><br><span class="line">科技制高点系列报道也时代新气象新作为影片提供机构的炮击是美国支持在叙利亚会的无声</span><br><span class="line">人民保护部队叙利亚政府警告方抚养条件美国国会参议院未能通过联保证处理事故美国联保</span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<p>We can see that even there are several typos here, it’s still above the average.</p>
<h3 id="The-results"><a href="#The-results" class="headerlink" title="The results"></a>The results</h3><p>You could find the results of ASR in the <code>text</code> folder under the <code>Chinese_Pipeline</code>. It’s the output by executing <code>code/infer.sh</code>.</p>
<h2 id="Acknowledgement"><a href="#Acknowledgement" class="headerlink" title="Acknowledgement"></a>Acknowledgement</h2><p>Here I would like to thank all of the support and help from my mentors in Red Hen Lab, especially Prof.Steen and Prof.Turner. They give me consistent support along the summer. </p>
<p>And I would like to thank Baidu for their kindness to open source such a great tool for us to use as well as give a clear documentation.</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/07/archivers/Prepare-the-Data-2/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhaoqing Xu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhaoqing Xu's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/07/07/archivers/Prepare-the-Data-2/" class="post-title-link" itemprop="url">Prepare the Data 2</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-07-07 00:00:00" itemprop="dateCreated datePublished" datetime="2018-07-07T00:00:00-04:00">2018-07-07</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-01-17 00:54:32" itemprop="dateModified" datetime="2019-01-17T00:54:32-05:00">2019-01-17</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/GSOC/" itemprop="url" rel="index"><span itemprop="name">GSOC</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Here I will write some shell scripts to automatically find all the Chinese videos in the datasets and transform them into the form that could be input in our DeepSpeech2 model.</p>
<h2 id="Find-the-Chinese-data"><a href="#Find-the-Chinese-data" class="headerlink" title="Find the Chinese data"></a>Find the Chinese data</h2><p>The data is all stored in the <code>/mnt/rds/redhen/gallina/tv/</code> directory, including English,French,Chinese and so on. To automatically find all the Chinese data from <code>2018-01</code> to <code>2018-06</code>, I write a shell script called <code>extract.sh</code>:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="built_in">cd</span> /mnt/rds/redhen/gallina/tv/2018</span><br><span class="line"><span class="keyword">for</span> date <span class="keyword">in</span> 2018-0&#123;1,2,3,4,5,6&#125;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">   <span class="built_in">cd</span> <span class="variable">$date</span></span><br><span class="line">   <span class="keyword">for</span> file <span class="keyword">in</span> `ls`</span><br><span class="line">   <span class="keyword">do</span></span><br><span class="line">        find ./<span class="variable">$file</span> -name <span class="string">'*_CN_*.mp4'</span> -<span class="built_in">exec</span> cp &#123;&#125; /mnt/rds/redhen/gallina/Singularity/data/<span class="variable">$date</span> \;</span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">$file</span></span><br><span class="line">   <span class="keyword">done</span></span><br><span class="line">   <span class="built_in">cd</span> ..</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">exit</span></span><br></pre></td></tr></table></figure></p>
<h2 id="Change-from-mp4-to-wav"><a href="#Change-from-mp4-to-wav" class="headerlink" title="Change from mp4 to wav"></a>Change from mp4 to wav</h2><p>To get the audio information from the videos, I create a shell script called <code>transform.sh</code>:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="built_in">cd</span> /mnt/rds/redhen/gallina/Singularity/data</span><br><span class="line"><span class="keyword">for</span> file <span class="keyword">in</span> `ls`</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  <span class="keyword">if</span> [ <span class="string">"<span class="variable">$file</span>"</span> != <span class="string">"wav"</span> ]</span><br><span class="line">  <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">for</span> mp4 <span class="keyword">in</span> `ls <span class="variable">$file</span>`</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">           ffmpeg -i ./<span class="variable">$file</span>/<span class="variable">$mp4</span> wav/<span class="variable">$file</span>/<span class="variable">$&#123;mp4%%.*&#125;</span>.wav</span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line"><span class="comment">## Split the data</span></span><br><span class="line">We have to split them into 10 seconds each to fit the input form. To automatically split them, we could use my shell script `split.sh`:</span><br><span class="line">```bash</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">cd</span> /mnt/rds/redhen/gallina/Singularity/data/wav</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'Split Begins'</span></span><br><span class="line"><span class="keyword">for</span> file <span class="keyword">in</span> `ls`</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">   <span class="keyword">for</span> wav <span class="keyword">in</span> `ls <span class="variable">$file</span>`</span><br><span class="line">   <span class="keyword">do</span></span><br><span class="line">        mkdir -p ../split/<span class="variable">$file</span>/<span class="variable">$&#123;wav%%.*&#125;</span></span><br><span class="line">        sox <span class="variable">$file</span>/<span class="variable">$wav</span>  ../split/<span class="variable">$file</span>/<span class="variable">$&#123;wav%%.*&#125;</span>/<span class="variable">$wav</span>  trim 0 10 : newfile : restart \;</span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">$file</span>/<span class="variable">$wav</span><span class="string">' split  done'</span></span><br><span class="line">   <span class="keyword">done</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">exit</span></span><br></pre></td></tr></table></figure></p>
<p>After that, we could find all the data in <code>/mnt/rds/redhen/gallina/Singularity/data/split</code>. all the wav files splitted from one video are placed into one folder with the same name of their video. Take one for example:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">[zxx302@hpc3 split]$ cd ../data/split</span><br><span class="line">[zxx302@hpc3 split]$ ls</span><br><span class="line">2018-01  2018-02  2018-03  2018-04  2018-05  2018-06</span><br><span class="line">[zxx302@hpc3 split]$ ls 2018-01</span><br><span class="line">2018-01-08_0410_CN_HNTV1_午间新闻</span><br><span class="line">2018-01-09_0410_CN_HNTV1_午间新闻</span><br><span class="line">2018-01-09_1100_CN_CCTV1_新闻联播</span><br><span class="line">2018-01-09_1359_CN_CCTV1_晚间新闻</span><br><span class="line">2018-01-09_1500_CN_CCTV1_24小时</span><br><span class="line">2018-01-09_2033_CN_CCTV13_新闻1+1</span><br><span class="line">2018-01-09_2300_CN_HNCSTV_Changsha_News</span><br><span class="line">2018-01-10_0410_CN_HNTV1_午间新闻</span><br><span class="line">2018-01-10_1100_CN_CCTV1_新闻联播</span><br><span class="line">2018-01-10_1359_CN_CCTV1_晚间新闻</span><br><span class="line">2018-01-10_1500_CN_CCTV1_24小时</span><br><span class="line">2018-01-10_2033_CN_CCTV13_新闻1+1</span><br><span class="line">2018-01-10_2300_CN_HNCSTV_Changsha_News</span><br><span class="line">2018-01-11_0410_CN_HNTV1_午间新闻</span><br><span class="line">...</span><br><span class="line">[zxx302@hpc3 split]$ ls 2018-01/2018-01-26_2033_CN_CCTV13_新闻1+1/</span><br><span class="line">2018-01-26_2033_CN_CCTV13_新闻1+1001.wav  2018-01-26_2033_CN_CCTV13_新闻1+1055.wav  2018-01-26_2033_CN_CCTV13_新闻1+1109.wav</span><br><span class="line">2018-01-26_2033_CN_CCTV13_新闻1+1002.wav  2018-01-26_2033_CN_CCTV13_新闻1+1056.wav  2018-01-26_2033_CN_CCTV13_新闻1+1110.wav</span><br><span class="line">2018-01-26_2033_CN_CCTV13_新闻1+1003.wav  2018-01-26_2033_CN_CCTV13_新闻1+1057.wav  2018-01-26_2033_CN_CCTV13_新闻1+1111.wav</span><br><span class="line">2018-01-26_2033_CN_CCTV13_新闻1+1004.wav  2018-01-26_2033_CN_CCTV13_新闻1+1058.wav  2018-01-26_2033_CN_CCTV13_新闻1+1112.wav</span><br><span class="line">2018-01-26_2033_CN_CCTV13_新闻1+1005.wav  2018-01-26_2033_CN_CCTV13_新闻1+1059.wav  2018-01-26_2033_CN_CCTV13_新闻1+1113.wav</span><br><span class="line">2018-01-26_2033_CN_CCTV13_新闻1+1006.wav  2018-01-26_2033_CN_CCTV13_新闻1+1060.wav  2018-01-26_2033_CN_CCTV13_新闻1+1114.wav</span><br><span class="line">2018-01-26_2033_CN_CCTV13_新闻1+1007.wav  2018-01-26_2033_CN_CCTV13_新闻1+1061.wav  2018-01-26_2033_CN_CCTV13_新闻1+1115.wav</span><br><span class="line">2018-01-26_2033_CN_CCTV13_新闻1+1008.wav  2018-01-26_2033_CN_CCTV13_新闻1+1062.wav  2018-01-26_2033_CN_CCTV13_新闻1+1116.wav</span><br><span class="line">2018-01-26_2033_CN_CCTV13_新闻1+1009.wav  2018-01-26_2033_CN_CCTV13_新闻1+1063.wav  2018-01-26_2033_CN_CCTV13_新闻1+1117.wav</span><br><span class="line">2018-01-26_2033_CN_CCTV13_新闻1+1010.wav  2018-01-26_2033_CN_CCTV13_新闻1+1064.wav  2018-01-26_2033_CN_CCTV13_新闻1+1118.wav</span><br><span class="line">2018-01-26_2033_CN_CCTV13_新闻1+1011.wav  2018-01-26_2033_CN_CCTV13_新闻1+1065.wav  2018-01-26_2033_CN_CCTV13_新闻1+1119.wav</span><br><span class="line">2018-01-26_2033_CN_CCTV13_新闻1+1012.wav  2018-01-26_2033_CN_CCTV13_新闻1+1066.wav  2018-01-26_2033_CN_CCTV13_新闻1+1120.wav</span><br><span class="line">2018-01-26_2033_CN_CCTV13_新闻1+1013.wav  2018-01-26_2033_CN_CCTV13_新闻1+1067.wav  2018-01-26_2033_CN_CCTV13_新闻1+1121.wav</span><br><span class="line">2018-01-26_2033_CN_CCTV13_新闻1+1014.wav  2018-01-26_2033_CN_CCTV13_新闻1+1068.wav  2018-01-26_2033_CN_CCTV13_新闻1+1122.wav</span><br><span class="line">2018-01-26_2033_CN_CCTV13_新闻1+1015.wav  2018-01-26_2033_CN_CCTV13_新闻1+1069.wav  2018-01-26_2033_CN_CCTV13_新闻1+1123.wav</span><br><span class="line">2018-01-26_2033_CN_CCTV13_新闻1+1016.wav  2018-01-26_2033_CN_CCTV13_新闻1+1070.wav  2018-01-26_2033_CN_CCTV13_新闻1+1124.wav</span><br><span class="line">2018-01-26_2033_CN_CCTV13_新闻1+1017.wav  2018-01-26_2033_CN_CCTV13_新闻1+1071.wav  2018-01-26_2033_CN_CCTV13_新闻1+1125.wav</span><br><span class="line">2018-01-26_2033_CN_CCTV13_新闻1+1018.wav  2018-01-26_2033_CN_CCTV13_新闻1+1072.wav  2018-01-26_2033_CN_CCTV13_新闻1+1126.wav</span><br><span class="line">2018-01-26_2033_CN_CCTV13_新闻1+1019.wav  2018-01-26_2033_CN_CCTV13_新闻1+1073.wav  2018-01-26_2033_CN_CCTV13_新闻1+1127.wav</span><br><span class="line">2018-01-26_2033_CN_CCTV13_新闻1+1020.wav  2018-01-26_2033_CN_CCTV13_新闻1+1074.wav  2018-01-26_2033_CN_CCTV13_新闻1+1128.wav</span><br><span class="line">2018-01-26_2033_CN_CCTV13_新闻1+1021.wav  2018-01-26_2033_CN_CCTV13_新闻1+1075.wav  2018-01-26_2033_CN_CCTV13_新闻1+1129.wav</span><br><span class="line">2018-01-26_2033_CN_CCTV13_新闻1+1022.wav  2018-01-26_2033_CN_CCTV13_新闻1+1076.wav  2018-01-26_2033_CN_CCTV13_新闻1+1130.wav</span><br><span class="line">2018-01-26_2033_CN_CCTV13_新闻1+1023.wav  2018-01-26_2033_CN_CCTV13_新闻1+1077.wav  2018-01-26_2033_CN_CCTV13_新闻1+1131.wav</span><br><span class="line">2018-01-26_2033_CN_CCTV13_新闻1+1024.wav  2018-01-26_2033_CN_CCTV13_新闻1+1078.wav  2018-01-26_2033_CN_CCTV13_新闻1+1132.wav</span><br><span class="line">2018-01-26_2033_CN_CCTV13_新闻1+1025.wav  2018-01-26_2033_CN_CCTV13_新闻1+1079.wav  2018-01-26_2033_CN_CCTV13_新闻1+1133.wav</span><br><span class="line">2018-01-26_2033_CN_CCTV13_新闻1+1026.wav  2018-01-26_2033_CN_CCTV13_新闻1+1080.wav  2018-01-26_2033_CN_CCTV13_新闻1+1134.wav</span><br><span class="line">2018-01-26_2033_CN_CCTV13_新闻1+1027.wav  2018-01-26_2033_CN_CCTV13_新闻1+1081.wav  2018-01-26_2033_CN_CCTV13_新闻1+1135.wav</span><br><span class="line">2018-01-26_2033_CN_CCTV13_新闻1+1028.wav  2018-01-26_2033_CN_CCTV13_新闻1+1082.wav  2018-01-26_2033_CN_CCTV13_新闻1+1136.wav</span><br><span class="line">2018-01-26_2033_CN_CCTV13_新闻1+1029.wav  2018-01-26_2033_CN_CCTV13_新闻1+1083.wav  2018-01-26_2033_CN_CCTV13_新闻1+1137.wav</span><br><span class="line">2018-01-26_2033_CN_CCTV13_新闻1+1030.wav  2018-01-26_2033_CN_CCTV13_新闻1+1084.wav  2018-01-26_2033_CN_CCTV13_新闻1+1138.wav</span><br><span class="line">2018-01-26_2033_CN_CCTV13_新闻1+1031.wav  2018-01-26_2033_CN_CCTV13_新闻1+1085.wav  2018-01-26_2033_CN_CCTV13_新闻1+1139.wav</span><br><span class="line">2018-01-26_2033_CN_CCTV13_新闻1+1032.wav  2018-01-26_2033_CN_CCTV13_新闻1+1086.wav  2018-01-26_2033_CN_CCTV13_新闻1+1140.wav</span><br><span class="line">2018-01-26_2033_CN_CCTV13_新闻1+1033.wav  2018-01-26_2033_CN_CCTV13_新闻1+1087.wav  2018-01-26_2033_CN_CCTV13_新闻1+1141.wav</span><br><span class="line">2018-01-26_2033_CN_CCTV13_新闻1+1034.wav  2018-01-26_2033_CN_CCTV13_新闻1+1088.wav  2018-01-26_2033_CN_CCTV13_新闻1+1142.wav</span><br><span class="line">2018-01-26_2033_CN_CCTV13_新闻1+1035.wav  2018-01-26_2033_CN_CCTV13_新闻1+1089.wav  2018-01-26_2033_CN_CCTV13_新闻1+1143.wav</span><br><span class="line">2018-01-26_2033_CN_CCTV13_新闻1+1036.wav  2018-01-26_2033_CN_CCTV13_新闻1+1090.wav  2018-01-26_2033_CN_CCTV13_新闻1+1144.wav</span><br><span class="line">2018-01-26_2033_CN_CCTV13_新闻1+1037.wav  2018-01-26_2033_CN_CCTV13_新闻1+1091.wav  2018-01-26_2033_CN_CCTV13_新闻1+1145.wav</span><br><span class="line">2018-01-26_2033_CN_CCTV13_新闻1+1038.wav  2018-01-26_2033_CN_CCTV13_新闻1+1092.wav  2018-01-26_2033_CN_CCTV13_新闻1+1146.wav</span><br><span class="line">2018-01-26_2033_CN_CCTV13_新闻1+1039.wav  2018-01-26_2033_CN_CCTV13_新闻1+1093.wav  2018-01-26_2033_CN_CCTV13_新闻1+1147.wav</span><br><span class="line">2018-01-26_2033_CN_CCTV13_新闻1+1040.wav  2018-01-26_2033_CN_CCTV13_新闻1+1094.wav  2018-01-26_2033_CN_CCTV13_新闻1+1148.wav</span><br><span class="line">2018-01-26_2033_CN_CCTV13_新闻1+1041.wav  2018-01-26_2033_CN_CCTV13_新闻1+1095.wav  2018-01-26_2033_CN_CCTV13_新闻1+1149.wav</span><br><span class="line">2018-01-26_2033_CN_CCTV13_新闻1+1042.wav  2018-01-26_2033_CN_CCTV13_新闻1+1096.wav  2018-01-26_2033_CN_CCTV13_新闻1+1150.wav</span><br><span class="line">2018-01-26_2033_CN_CCTV13_新闻1+1043.wav  2018-01-26_2033_CN_CCTV13_新闻1+1097.wav  2018-01-26_2033_CN_CCTV13_新闻1+1151.wav</span><br><span class="line">2018-01-26_2033_CN_CCTV13_新闻1+1044.wav  2018-01-26_2033_CN_CCTV13_新闻1+1098.wav  2018-01-26_2033_CN_CCTV13_新闻1+1152.wav</span><br><span class="line">2018-01-26_2033_CN_CCTV13_新闻1+1045.wav  2018-01-26_2033_CN_CCTV13_新闻1+1099.wav  2018-01-26_2033_CN_CCTV13_新闻1+1153.wav</span><br><span class="line">2018-01-26_2033_CN_CCTV13_新闻1+1046.wav  2018-01-26_2033_CN_CCTV13_新闻1+1100.wav  2018-01-26_2033_CN_CCTV13_新闻1+1154.wav</span><br><span class="line">2018-01-26_2033_CN_CCTV13_新闻1+1047.wav  2018-01-26_2033_CN_CCTV13_新闻1+1101.wav  2018-01-26_2033_CN_CCTV13_新闻1+1155.wav</span><br><span class="line">2018-01-26_2033_CN_CCTV13_新闻1+1048.wav  2018-01-26_2033_CN_CCTV13_新闻1+1102.wav  2018-01-26_2033_CN_CCTV13_新闻1+1156.wav</span><br><span class="line">2018-01-26_2033_CN_CCTV13_新闻1+1049.wav  2018-01-26_2033_CN_CCTV13_新闻1+1103.wav  2018-01-26_2033_CN_CCTV13_新闻1+1157.wav</span><br><span class="line">2018-01-26_2033_CN_CCTV13_新闻1+1050.wav  2018-01-26_2033_CN_CCTV13_新闻1+1104.wav  2018-01-26_2033_CN_CCTV13_新闻1+1158.wav</span><br><span class="line">2018-01-26_2033_CN_CCTV13_新闻1+1051.wav  2018-01-26_2033_CN_CCTV13_新闻1+1105.wav  2018-01-26_2033_CN_CCTV13_新闻1+1159.wav</span><br><span class="line">2018-01-26_2033_CN_CCTV13_新闻1+1052.wav  2018-01-26_2033_CN_CCTV13_新闻1+1106.wav  2018-01-26_2033_CN_CCTV13_新闻1+1160.wav</span><br><span class="line">2018-01-26_2033_CN_CCTV13_新闻1+1053.wav  2018-01-26_2033_CN_CCTV13_新闻1+1107.wav  2018-01-26_2033_CN_CCTV13_新闻1+1161.wav</span><br><span class="line">2018-01-26_2033_CN_CCTV13_新闻1+1054.wav  2018-01-26_2033_CN_CCTV13_新闻1+1108.wav  2018-01-26_2033_CN_CCTV13_新闻1+1162.wav</span><br></pre></td></tr></table></figure></p>
<p>Thus, we have done all the preparation. The next step is to infer the results from our model. Due to some CUDA problems, It’s still on the progress. Thanks for your reading!</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/22/archivers/Write-a-Singularity-Recipe/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhaoqing Xu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhaoqing Xu's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/06/22/archivers/Write-a-Singularity-Recipe/" class="post-title-link" itemprop="url">Write a Singularity Recipe</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-06-22 00:00:00" itemprop="dateCreated datePublished" datetime="2018-06-22T00:00:00-04:00">2018-06-22</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-01-17 00:54:32" itemprop="dateModified" datetime="2019-01-17T00:54:32-05:00">2019-01-17</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/GSOC/" itemprop="url" rel="index"><span itemprop="name">GSOC</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>I met singularity when I was doing GSOC task for PaddlePaddle:DeepSpeech. So here I will show you how to build a custom singularity image from scratch.</p>
<h1 id="What’s-the-Singularity-Recipe"><a href="#What’s-the-Singularity-Recipe" class="headerlink" title="What’s the Singularity Recipe"></a>What’s the Singularity Recipe</h1><p>Firstly, let me briefly summarize what’s the singularity recipe and what would it help? It’s similarly with the shell script or makefile which we write in the linux/unix to help us run linux command automatically. A singularity recipe helps us build the image by running those installing commands in the Singularity Hub environment. For instance, when we add <code>apt install vim</code> in the recipe, it will install the vim for your environment or what we say, your image. So you can always copy all the commands you will do that set up the satisfying environment into the recipe to build an image by uploading it to <a href="https://singularity-hub.org/collections" target="_blank" rel="noopener">Singularity Hub</a>.  </p>
<h1 id="How-to-write-a-Singularity-Recipe"><a href="#How-to-write-a-Singularity-Recipe" class="headerlink" title="How to write a Singularity Recipe"></a>How to write a Singularity Recipe</h1><p>I think the <a href="https://github.com/singularityhub/singularityhub.github.io/wiki/Build-A-Container" target="_blank" rel="noopener">official docs</a> explained it clearly so I won’t repeat, but pay attention that if you’d like to modify a singularity image or a docker image to fit your demand, (which is very common and recommended), just use:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Bootstrap:docker  </span><br><span class="line">From:ubuntu:latest</span><br></pre></td></tr></table></figure></p>
<p><code>ubuntu:latest</code> is an example,<br>we could change with:<code>From:paddlepaddle/deep_speech:latest-gpu</code> so that we could inherit all the tools and pacages in that image and  add other tools to help with our project.</p>
<h1 id="How-to-upload-it"><a href="#How-to-upload-it" class="headerlink" title="How to upload it?"></a>How to upload it?</h1><p>So how could we build our DeepSpeech image to help us with our work? Just as mentioned in the <a href="https://github.com/singularityhub/singularityhub.github.io/wiki/Build-A-Container" target="_blank" rel="noopener">Build the container</a>, we should create a new Github repository, and push the Singularity recipe to the repository, and then we connect the repository with our singularity hub account, and it’s done. Really easy!</p>
<h1 id="How-to-download-the-image-and-use-it"><a href="#How-to-download-the-image-and-use-it" class="headerlink" title="How to download the image and use it"></a>How to download the image and use it</h1><p>take my image as an example: just run<br><code>singularity pull shub://xuzhaoqing/DeepSpeech</code><br>after we download it correctly, we could jump into the image by typing<br><code>singularity singularity shell -e &lt;image name&gt;</code></p>
<p>Thanks for your reading! Hope you could get some intuition from this article.</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/22/archivers/Prepare-the-Data/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhaoqing Xu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhaoqing Xu's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/06/22/archivers/Prepare-the-Data/" class="post-title-link" itemprop="url">Prepare the Data</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-06-22 00:00:00" itemprop="dateCreated datePublished" datetime="2018-06-22T00:00:00-04:00">2018-06-22</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-01-17 00:54:32" itemprop="dateModified" datetime="2019-01-17T00:54:32-05:00">2019-01-17</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/GSOC/" itemprop="url" rel="index"><span itemprop="name">GSOC</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Get-into-the-singularity-image"><a href="#Get-into-the-singularity-image" class="headerlink" title="Get into the singularity image"></a>Get into the singularity image</h2><p>(you could just skip this part because it has been shown by <a href="https://cynthiasuwi.github.io//GSoC-Week3/" target="_blank" rel="noopener">Shuwei</a>)</p>
<p><em>Notice that we don’t need to get into the image in this article</em></p>
<p>Firstly, we need to download the deepspeech image from shub://xuzhaoqing/DeepSpeech by typing:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">singularity pull shub://xuzhaoqing/DeepSpeech</span><br></pre></td></tr></table></figure></p>
<p>Then we rename its name to deepspeech2.simg (for convenience) by typing:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv xuzhaoqing-DeepSpeech-master-latest.simg deepspeech2.simg</span><br></pre></td></tr></table></figure></p>
<p>Then I tried to use the command like Shuwei’s, but I failed:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[zxx302@gpu030t zxx302]$ singularity shell -e -H /mnt/rds/redhen/gallina/Singularity/DeepSpeech2/DeepSpeech/ deepspeech2.simg </span><br><span class="line"></span><br><span class="line">ERROR  : Home directory is not owned by calling user: /mnt/rds/redhen/gallina/Singularity/DeepSpeech2/DeepSpeech/</span><br><span class="line">ABORT  : Retval = 255</span><br></pre></td></tr></table></figure></p>
<p>So I did the processing on my home directory, which is zxx302. But anyway it doesn’t matter.</p>
<p>I then clone DeepSpeech to my directory using:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/PaddlePaddle/DeepSpeech.git</span><br></pre></td></tr></table></figure></p>
<h2 id="Data-Form"><a href="#Data-Form" class="headerlink" title="Data Form"></a>Data Form</h2><p>From today on we’re going to prepare the data for the inputs of the deepspeech model. As you can see in the data shown by Baidu, the data input should be splited into pieces, each with 3-7 seconds. It’s really easy to understand because the technologies like Markov chain, RNN and GRU couldn’t “remember” too long sentences. So we have to split our 30 minutes’ data to 5 seconds.</p>
<p>Take one small data sample for intuition:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">BAC009S0658W0121.wav  BAC009S0658W0242.wav  BAC009S0658W0375.wav</span><br><span class="line">BAC009S0658W0122.wav  BAC009S0658W0243.wav  BAC009S0658W0376.wav</span><br><span class="line">BAC009S0658W0123.wav  BAC009S0658W0244.wav  BAC009S0658W0377.wav</span><br><span class="line">BAC009S0658W0124.wav  BAC009S0658W0245.wav  BAC009S0658W0378.wav</span><br></pre></td></tr></table></figure></p>
<p>As you can see, BAC009S0658W0 is previously a long audio, and it’s splited by a tool called sox into nearly 500 pieces.  </p>
<h2 id="Split-the-audio"><a href="#Split-the-audio" class="headerlink" title="Split the audio"></a>Split the audio</h2><p><strong>transform the video to audio</strong><br>by typing the code shown, we could transform the video to audio<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i 2018-04-30_1100_CN_CCTV1_新闻联播.mp4 2018-04-30_1100_CN_CCTV1_新闻联播.wav</span><br></pre></td></tr></table></figure></p>
<p><strong>split it</strong><br>we then create a folder called <code>split</code> to store the pieces:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir split</span><br></pre></td></tr></table></figure></p>
<p>and use <code>sox</code> to split the audio<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find . -name &apos;*.wav&apos;  -exec sh -c &apos;mkdir -p ./split/$(dirname &quot;&#123;&#125;&quot;)&apos; \;  -exec sox &#123;&#125; ./split/&#123;&#125;  trim 0 10 : newfile : restart \;</span><br></pre></td></tr></table></figure></p>
<p>Here, as you can see, <code>10</code> means the seconds you’d like to split,here I choose <code>10</code></p>
<p><strong>I have copyed <code>2018-04-30_1100_CN_CCTV1_新闻联播.wav</code> to <code>/mnt/rds/redhen/gallina/Singularity/Zhaoqing/</code> so that any of you could try following the steps</strong></p>
<h2 id="Next-step"><a href="#Next-step" class="headerlink" title="Next step"></a>Next step</h2><p>There are two parts of tasks for us to solve: one is to test if the data works for the model, the other is to write runscripts to process all the data. We will be in progress soon. Any suggestions? </p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Zhaoqing Xu</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">6</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                    
                      
                    
                    <span class="site-state-item-count">1</span>
                    <span class="site-state-item-name">categories</span>
                  
                </div>
              

              
            </nav>
          

          

          

          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zhaoqing Xu</span>

  

  
</div>


  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v6.7.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=6.7.0"></script>

  <script src="/js/src/motion.js?v=6.7.0"></script>



  
  


  <script src="/js/src/affix.js?v=6.7.0"></script>

  <script src="/js/src/schemes/pisces.js?v=6.7.0"></script>



  

  


  <script src="/js/src/bootstrap.js?v=6.7.0"></script>



  



  





  

  

  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
